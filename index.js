const express = require("express");
const multer = require("multer");
const fs = require("fs");
const { exec } = require("child_process");

const app = express();
const upload = multer({ dest: "uploads/" });

app.post("/upload", upload.single("file"), (req, res) => {
  const filePath = req.file.path;
  const command = `./axmldec/axmldec -o output.xml ${filePath}`; // Replace 'your-command' with the actual command

  exec(command, (error, stdout, stderr) => {
    if (error) {
      console.error(`exec error: ${error}`);
      return res
        .status(500)
        .send("An error occurred while processing the file.");
    }
    console.log("LOG");

    fs.readFile("./output.xml", (err, data) => {
      if (err) {
        console.error(`readFile error: ${err}`);
        return res
          .status(500)
          .send("An error occurred while reading the file.");
      }

      res.set("Content-Type", "text/xml");
      res.send(data);
    });
  });
});

app.listen(3000, () => console.log("Server started on port 3000"));
